<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>For√ßar Coordenadas Corretas - Meu Bairro Alerta</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 2rem auto;
            padding: 2rem;
            background: #f5f5f5;
            line-height: 1.6;
        }
        .container {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            margin-bottom: 3rem;
            padding-bottom: 2rem;
            border-bottom: 3px solid #dc3545;
        }
        .problema-alert {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 2rem 0;
            color: #721c24;
        }
        .solucao-box {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 2rem 0;
            color: #155724;
        }
        .btn {
            display: inline-block;
            padding: 1rem 2rem;
            background: #dc3545;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-weight: bold;
            margin: 0.5rem;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.1rem;
        }
        .btn:hover {
            background: #c82333;
            transform: translateY(-2px);
        }
        .btn-success { background: #28a745; }
        .btn-warning { background: #ffc107; color: #333; }
        .btn-info { background: #17a2b8; }
        .btn-large {
            padding: 1.5rem 3rem;
            font-size: 1.3rem;
        }
        .coordenadas-display {
            background: #2d3748;
            color: #e2e8f0;
            padding: 1.5rem;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            margin: 1rem 0;
            text-align: center;
        }
        .step-box {
            background: #f8f9fa;
            border-left: 4px solid #007bff;
            padding: 1.5rem;
            margin: 1rem 0;
            border-radius: 0 8px 8px 0;
        }
        .step-number {
            background: #007bff;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 1rem;
        }
        .resultado {
            background: #e7f3ff;
            border: 1px solid #b3d9ff;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 2rem 0;
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-exclamation-triangle"></i> For√ßar Coordenadas Corretas</h1>
            <p>Solu√ß√£o definitiva para corrigir as coordenadas no mapa</p>
        </div>

        <!-- Problema -->
        <div class="problema-alert">
            <h3><i class="fas fa-bug"></i> Problema Identificado</h3>
            <p><strong>Situa√ß√£o:</strong> As reclama√ß√µes continuam aparecendo no centro de S√£o Paulo mesmo ap√≥s as corre√ß√µes.</p>
            <p><strong>Causa:</strong> As coordenadas n√£o est√£o sendo aplicadas corretamente ou h√° cache impedindo a atualiza√ß√£o.</p>
        </div>

        <!-- Coordenadas Corretas -->
        <div class="coordenadas-display">
            <h3>üìç COORDENADAS CORRETAS</h3>
            <div style="font-size: 1.2rem; margin: 1rem 0;">
                <strong>Latitude:</strong> -23.5751<br>
                <strong>Longitude:</strong> -46.4537
            </div>
            <small>Estas coordenadas ser√£o aplicadas para S√£o Mateus e S√£o Rafael</small>
        </div>

        <!-- Solu√ß√£o Principal -->
        <div class="solucao-box">
            <h3><i class="fas fa-magic"></i> Solu√ß√£o Definitiva</h3>
            <p>Esta ferramenta vai for√ßar a aplica√ß√£o das coordenadas corretas diretamente no seu navegador.</p>
            
            <div style="text-align: center; margin: 2rem 0;">
                <button class="btn btn-success btn-large" onclick="aplicarCoordenadasForcado()">
                    <i class="fas fa-rocket"></i> APLICAR COORDENADAS AGORA
                </button>
            </div>
        </div>

        <!-- Passos Detalhados -->
        <div class="step-box">
            <h3><i class="fas fa-list-ol"></i> Passos que Ser√£o Executados</h3>
            
            <div style="display: flex; align-items: center; margin: 1rem 0;">
                <span class="step-number">1</span>
                <span>Limpar coordenadas antigas do cache</span>
            </div>
            
            <div style="display: flex; align-items: center; margin: 1rem 0;">
                <span class="step-number">2</span>
                <span>Aplicar coordenadas corretas (-23.5751, -46.4537)</span>
            </div>
            
            <div style="display: flex; align-items: center; margin: 1rem 0;">
                <span class="step-number">3</span>
                <span>Atualizar todas as reclama√ß√µes existentes</span>
            </div>
            
            <div style="display: flex; align-items: center; margin: 1rem 0;">
                <span class="step-number">4</span>
                <span>For√ßar recarregamento do sistema de mapa</span>
            </div>
        </div>

        <!-- Resultado -->
        <div id="resultado" class="resultado">
            <h4><i class="fas fa-check-circle"></i> Coordenadas Aplicadas com Sucesso!</h4>
            <div id="resultadoTexto"></div>
        </div>

        <!-- Verifica√ß√£o -->
        <div style="background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 8px; padding: 1.5rem; margin: 2rem 0;">
            <h4><i class="fas fa-search"></i> Como Verificar se Funcionou</h4>
            <ol>
                <li><strong>V√° para o site principal</strong> (index.html ou site online)</li>
                <li><strong>Pressione Ctrl+F5</strong> para recarregar completamente</li>
                <li><strong>V√° para a se√ß√£o "Mapa"</strong></li>
                <li><strong>Verifique</strong> se as reclama√ß√µes aparecem na localiza√ß√£o correta</li>
                <li><strong>Se n√£o funcionar,</strong> crie uma nova reclama√ß√£o de teste</li>
            </ol>
        </div>

        <!-- A√ß√µes Adicionais -->
        <div style="text-align: center; margin: 2rem 0;">
            <button class="btn btn-info" onclick="criarReclamacaoTeste()">
                <i class="fas fa-plus"></i> Criar Reclama√ß√£o Teste
            </button>
            <button class="btn btn-warning" onclick="limparCacheCompleto()">
                <i class="fas fa-trash"></i> Limpar Cache Completo
            </button>
        </div>

        <!-- Links -->
        <div style="text-align: center; margin: 3rem 0;">
            <a href="index.html" target="_blank" class="btn btn-info">
                <i class="fas fa-home"></i> Site Principal
            </a>
            <a href="https://meubairroalerta.netlify.app" target="_blank" class="btn">
                <i class="fas fa-globe"></i> Site Online
            </a>
        </div>

        <!-- Footer -->
        <footer style="text-align: center; margin-top: 3rem; padding-top: 2rem; border-top: 1px solid #e9ecef;">
            <p style="color: #666;">&copy; 2024 Meu Bairro Alerta</p>
            <p style="color: #666; font-size: 0.9rem;">
                <i class="fas fa-code"></i> Criado por <strong>ProfBorges</strong>
            </p>
        </footer>
    </div>

    <script>
        const coordenadasCorretas = [-23.5751, -46.4537];

        function aplicarCoordenadasForcado() {
            console.log('üöÄ Iniciando aplica√ß√£o for√ßada das coordenadas...');
            
            try {
                // 1. Limpar coordenadas antigas
                localStorage.removeItem('coordenadasCustomizadas');
                console.log('‚úÖ Cache de coordenadas limpo');
                
                // 2. Aplicar coordenadas corretas
                const novasCoordenadas = {
                    's√£o mateus': coordenadasCorretas,
                    'sao mateus': coordenadasCorretas,
                    's√£o rafael': coordenadasCorretas,
                    'sao rafael': coordenadasCorretas,
                    'centro': [-23.5505, -46.6333] // Manter centro como refer√™ncia
                };
                
                localStorage.setItem('coordenadasCustomizadas', JSON.stringify(novasCoordenadas));
                console.log('‚úÖ Novas coordenadas aplicadas:', novasCoordenadas);
                
                // 3. Atualizar reclama√ß√µes existentes
                let reclamacoes = JSON.parse(localStorage.getItem('reclamacoes') || '[]');
                let reclamacoesAtualizadas = 0;
                
                reclamacoes.forEach(reclamacao => {
                    const loc = reclamacao.localizacao.toLowerCase();
                    if (loc.includes('s√£o mateus') || loc.includes('sao mateus') || 
                        loc.includes('s√£o rafael') || loc.includes('sao rafael')) {
                        reclamacao.coordenadas = coordenadasCorretas;
                        reclamacao.coordenadasAtualizadas = new Date().toISOString();
                        reclamacoesAtualizadas++;
                    }
                });
                
                if (reclamacoesAtualizadas > 0) {
                    localStorage.setItem('reclamacoes', JSON.stringify(reclamacoes));
                    console.log(`‚úÖ ${reclamacoesAtualizadas} reclama√ß√µes atualizadas`);
                }
                
                // 4. For√ßar timestamp de atualiza√ß√£o
                localStorage.setItem('coordenadasAtualizadas', Date.now().toString());
                localStorage.setItem('forceMapReload', 'true');
                
                // 5. Mostrar resultado
                mostrarResultado(reclamacoesAtualizadas);
                
                console.log('üéâ Aplica√ß√£o for√ßada conclu√≠da com sucesso!');
                
            } catch (error) {
                console.error('‚ùå Erro na aplica√ß√£o for√ßada:', error);
                alert('‚ùå Erro ao aplicar coordenadas: ' + error.message);
            }
        }

        function mostrarResultado(reclamacoesAtualizadas) {
            const resultado = document.getElementById('resultado');
            const resultadoTexto = document.getElementById('resultadoTexto');
            
            resultado.style.display = 'block';
            resultadoTexto.innerHTML = `
                <p><strong>‚úÖ Coordenadas aplicadas com sucesso!</strong></p>
                <p><strong>üìç Coordenadas:</strong> ${coordenadasCorretas[0]}, ${coordenadasCorretas[1]}</p>
                <p><strong>üéØ Aplicado para:</strong> S√£o Mateus e S√£o Rafael</p>
                <p><strong>üìä Reclama√ß√µes atualizadas:</strong> ${reclamacoesAtualizadas}</p>
                <p><strong>‚è∞ Timestamp:</strong> ${new Date().toLocaleString('pt-BR')}</p>
                
                <div style="background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 5px; padding: 1rem; margin: 1rem 0;">
                    <strong>üéØ Pr√≥ximos Passos:</strong><br>
                    1. V√° para o site principal<br>
                    2. Pressione <strong>Ctrl+F5</strong> (for√ßa recarregamento)<br>
                    3. V√° para a se√ß√£o "Mapa"<br>
                    4. Verifique se as reclama√ß√µes aparecem na localiza√ß√£o correta
                </div>
            `;
            
            // Scroll para o resultado
            resultado.scrollIntoView({ behavior: 'smooth' });
        }

        function criarReclamacaoTeste() {
            console.log('‚ûï Criando reclama√ß√£o de teste...');
            
            try {
                const reclamacao = {
                    id: Date.now().toString(),
                    titulo: 'TESTE COORDENADAS FOR√áADAS - ' + new Date().toLocaleTimeString('pt-BR'),
                    categoria: 'outros',
                    descricao: 'Reclama√ß√£o de teste para verificar se as coordenadas for√ßadas est√£o funcionando corretamente.',
                    localizacao: 'S√£o Mateus',
                    status: 'pendente',
                    usuario: 'Usu√°rio Teste',
                    usuarioId: 'teste',
                    dataReclamacao: new Date().toISOString(),
                    midia: [],
                    coordenadas: coordenadasCorretas,
                    coordenadasForcadas: true
                };
                
                let reclamacoes = JSON.parse(localStorage.getItem('reclamacoes') || '[]');
                reclamacoes.push(reclamacao);
                localStorage.setItem('reclamacoes', JSON.stringify(reclamacoes));
                
                alert(`‚úÖ Reclama√ß√£o de teste criada!

üìù T√≠tulo: ${reclamacao.titulo}
üìç Localiza√ß√£o: S√£o Mateus
üó∫Ô∏è Coordenadas: ${coordenadasCorretas[0]}, ${coordenadasCorretas[1]}

Agora v√° para o site principal e verifique se aparece na localiza√ß√£o correta!`);
                
                console.log('‚úÖ Reclama√ß√£o de teste criada:', reclamacao);
                
            } catch (error) {
                console.error('‚ùå Erro ao criar reclama√ß√£o:', error);
                alert('‚ùå Erro ao criar reclama√ß√£o de teste');
            }
        }

        function limparCacheCompleto() {
            if (confirm('‚ö†Ô∏è Isso ir√° limpar TODOS os dados do cache. Tem certeza?\n\n(Suas reclama√ß√µes ser√£o mantidas, apenas o cache ser√° limpo)')) {
                
                // Salvar dados importantes
                const reclamacoes = localStorage.getItem('reclamacoes');
                const usuarios = localStorage.getItem('usuarios');
                const currentUser = localStorage.getItem('currentUser');
                
                // Limpar tudo
                localStorage.clear();
                
                // Restaurar dados importantes
                if (reclamacoes) localStorage.setItem('reclamacoes', reclamacoes);
                if (usuarios) localStorage.setItem('usuarios', usuarios);
                if (currentUser) localStorage.setItem('currentUser', currentUser);
                
                // Aplicar coordenadas novamente
                aplicarCoordenadasForcado();
                
                alert('‚úÖ Cache limpo e coordenadas reaplicadas!\n\nRecarregue o site principal (Ctrl+F5)');
            }
        }

        // Auto-executar se par√¢metro estiver presente
        document.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('auto') === 'true') {
                setTimeout(aplicarCoordenadasForcado, 1000);
            }
        });
    </script>
</body>
</html>
