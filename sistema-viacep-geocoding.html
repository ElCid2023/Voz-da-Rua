<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ViaCEP + Geocoding Preciso - Meu Bairro Alerta</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 2rem auto;
            padding: 2rem;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            margin-bottom: 3rem;
            padding-bottom: 2rem;
            border-bottom: 3px solid #28a745;
        }
        .sistema-info {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 2rem 0;
            color: #155724;
        }
        .form-group {
            margin-bottom: 1rem;
        }
        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: bold;
        }
        input, select, textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }
        input[readonly] {
            background: #f8f9fa;
            color: #666;
        }
        .btn {
            padding: 0.75rem 1.5rem;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 0.5rem;
            font-size: 1rem;
        }
        .btn:hover {
            background: #218838;
        }
        .btn-info { background: #17a2b8; }
        .btn-warning { background: #ffc107; color: #333; }
        .btn-danger { background: #dc3545; }
        .row {
            display: flex;
            gap: 1rem;
        }
        .row .form-group {
            flex: 1;
        }
        .loading {
            text-align: center;
            color: #28a745;
            font-style: italic;
            margin: 1rem 0;
            display: none;
        }
        .step-box {
            background: #f8f9fa;
            border-left: 4px solid #28a745;
            padding: 1.5rem;
            margin: 1rem 0;
            border-radius: 0 8px 8px 0;
            display: none;
        }
        .step-box.active {
            display: block;
        }
        .step-box.success {
            background: #d4edda;
            border-left-color: #28a745;
        }
        .step-box.error {
            background: #f8d7da;
            border-left-color: #dc3545;
        }
        .coord-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin: 1rem 0;
        }
        .coord-box {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 1rem;
            font-family: monospace;
        }
        .coord-box.precise {
            background: #d1ecf1;
            border-color: #bee5eb;
            color: #0c5460;
        }
        .map-embed {
            width: 100%;
            height: 400px;
            border: 2px solid #28a745;
            border-radius: 8px;
            margin: 1rem 0;
            display: none;
        }
        .test-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin: 2rem 0;
        }
        .progress-bar {
            background: #e9ecef;
            border-radius: 10px;
            height: 20px;
            margin: 1rem 0;
            overflow: hidden;
            display: none;
        }
        .progress-fill {
            background: #28a745;
            height: 100%;
            width: 0%;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.8rem;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-bullseye"></i> ViaCEP + Geocoding Preciso</h1>
            <p>Sistema h√≠brido: Dados oficiais + Coordenadas exatas</p>
        </div>

        <!-- Informa√ß√µes do Sistema -->
        <div class="sistema-info">
            <h3><i class="fas fa-cogs"></i> Como Funciona o Sistema H√≠brido</h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                <div>
                    <h4>üèõÔ∏è Etapa 1: ViaCEP</h4>
                    <ul>
                        <li>‚úÖ Consulta dados oficiais dos Correios</li>
                        <li>‚úÖ Obt√©m logradouro, bairro, cidade</li>
                        <li>‚úÖ Valida se √© S√£o Paulo capital</li>
                        <li>‚úÖ Garante dados corretos e oficiais</li>
                    </ul>
                </div>
                <div>
                    <h4>üéØ Etapa 2: Geocoding Preciso</h4>
                    <ul>
                        <li>‚úÖ Monta endere√ßo completo com n√∫mero</li>
                        <li>‚úÖ Faz geocodifica√ß√£o precisa da rua</li>
                        <li>‚úÖ Obt√©m coordenadas exatas do endere√ßo</li>
                        <li>‚úÖ Mostra localiza√ß√£o no mapa</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Barra de Progresso -->
        <div class="progress-bar" id="progressBar">
            <div class="progress-fill" id="progressFill">Iniciando...</div>
        </div>

        <!-- Formul√°rio -->
        <form id="hybridForm">
            <div class="form-group">
                <label for="titulo">T√≠tulo da Reclama√ß√£o:</label>
                <input type="text" id="titulo" placeholder="Ex: Buraco na rua" required>
            </div>

            <div class="form-group">
                <label for="categoria">Categoria:</label>
                <select id="categoria" required>
                    <option value="">Selecione uma categoria</option>
                    <option value="iluminacao">Ilumina√ß√£o P√∫blica</option>
                    <option value="asfalto">Asfalto/Pavimenta√ß√£o</option>
                    <option value="limpeza">Limpeza Urbana</option>
                    <option value="seguranca">Seguran√ßa</option>
                    <option value="transporte">Transporte P√∫blico</option>
                    <option value="agua">√Ågua/Esgoto</option>
                    <option value="outros">Outros</option>
                </select>
            </div>

            <div class="form-group">
                <label for="descricao">Descri√ß√£o:</label>
                <textarea id="descricao" rows="3" placeholder="Descreva o problema" required></textarea>
            </div>

            <h3 style="color: #28a745; margin: 2rem 0 1rem 0;">
                <i class="fas fa-map-marker-alt"></i> Localiza√ß√£o H√≠brida (ViaCEP + Geocoding)
            </h3>
            
            <div class="form-group">
                <label for="cep">CEP:</label>
                <input type="text" id="cep" placeholder="08330-310" maxlength="9" required>
                <small>Digite seu CEP para iniciar o processo h√≠brido</small>
            </div>
            
            <div class="row">
                <div class="form-group" style="flex: 3;">
                    <label for="logradouro">Logradouro (ViaCEP):</label>
                    <input type="text" id="logradouro" placeholder="Ser√° preenchido pelo ViaCEP" readonly>
                </div>
                <div class="form-group" style="flex: 1;">
                    <label for="numero">N√∫mero:</label>
                    <input type="text" id="numero" placeholder="123" required>
                </div>
            </div>
            
            <div class="row">
                <div class="form-group">
                    <label for="bairro">Bairro (ViaCEP):</label>
                    <input type="text" id="bairro" placeholder="Ser√° preenchido pelo ViaCEP" readonly>
                </div>
                <div class="form-group">
                    <label for="localidade">Cidade (ViaCEP):</label>
                    <input type="text" id="localidade" placeholder="Ser√° preenchido pelo ViaCEP" readonly>
                </div>
            </div>

            <!-- Etapas do Processo -->
            <div id="step1" class="step-box">
                <h4><i class="fas fa-search"></i> Etapa 1: Consultando ViaCEP</h4>
                <p>Buscando dados oficiais dos Correios...</p>
            </div>

            <div id="step2" class="step-box">
                <h4><i class="fas fa-check-circle"></i> Etapa 1: ViaCEP Conclu√≠do</h4>
                <div id="dadosViaCEP"></div>
            </div>

            <div id="step3" class="step-box">
                <h4><i class="fas fa-crosshairs"></i> Etapa 2: Geocodifica√ß√£o Precisa</h4>
                <p>Obtendo coordenadas exatas do endere√ßo completo...</p>
            </div>

            <div id="step4" class="step-box">
                <h4><i class="fas fa-map-pin"></i> Etapa 2: Geocodifica√ß√£o Conclu√≠da</h4>
                <div id="resultadoGeocoding"></div>
            </div>

            <!-- Compara√ß√£o de Coordenadas -->
            <div id="coordComparison" style="display: none;">
                <h4><i class="fas fa-balance-scale"></i> Compara√ß√£o de Precis√£o</h4>
                <div class="coord-comparison">
                    <div class="coord-box">
                        <h5>üìç Coordenadas Aproximadas (Bairro)</h5>
                        <div id="coordAproximadas"></div>
                        <small>Baseadas na regi√£o do bairro</small>
                    </div>
                    <div class="coord-box precise">
                        <h5>üéØ Coordenadas Precisas (Geocoding)</h5>
                        <div id="coordPrecisas"></div>
                        <small>Endere√ßo exato com n√∫mero</small>
                    </div>
                </div>
            </div>

            <!-- Mapa Embed -->
            <div id="mapaContainer">
                <h4><i class="fas fa-map"></i> Localiza√ß√£o Precisa no Mapa</h4>
                <iframe id="mapaEmbed" class="map-embed" frameborder="0" allowfullscreen></iframe>
                
                <div style="text-align: center; margin: 1rem 0;">
                    <button type="button" class="btn btn-info" onclick="abrirGoogleMaps()">
                        <i class="fas fa-external-link-alt"></i> Abrir no Google Maps
                    </button>
                    <button type="button" class="btn btn-warning" onclick="copiarCoordenadas()">
                        <i class="fas fa-copy"></i> Copiar Coordenadas Precisas
                    </button>
                    <button type="button" class="btn" onclick="copiarEndereco()">
                        <i class="fas fa-copy"></i> Copiar Endere√ßo Completo
                    </button>
                </div>
            </div>

            <div style="text-align: center; margin: 2rem 0;">
                <button type="submit" class="btn btn-success">
                    <i class="fas fa-paper-plane"></i> Criar Reclama√ß√£o com Localiza√ß√£o Precisa
                </button>
                <button type="button" class="btn btn-danger" onclick="limparFormulario()">
                    <i class="fas fa-eraser"></i> Limpar
                </button>
            </div>
        </form>

        <!-- CEPs para Teste -->
        <h3><i class="fas fa-list"></i> CEPs para Teste do Sistema H√≠brido</h3>
        <div class="test-buttons">
            <button class="btn btn-danger" onclick="testarCEP('08330-310')">
                Seu CEP<br>08330-310
            </button>
            <button class="btn" onclick="testarCEP('08330-000')">
                S√£o Rafael<br>08330-000
            </button>
            <button class="btn" onclick="testarCEP('08340-000')">
                S√£o Mateus<br>08340-000
            </button>
            <button class="btn" onclick="testarCEP('01310-100')">
                Av. Paulista<br>01310-100
            </button>
        </div>

        <!-- Vantagens -->
        <div style="background: #e9ecef; border-radius: 8px; padding: 1.5rem; margin: 2rem 0;">
            <h4><i class="fas fa-star"></i> Vantagens do Sistema H√≠brido</h4>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                <div>
                    <h5>üèõÔ∏è ViaCEP (Dados Oficiais)</h5>
                    <ul>
                        <li>‚úÖ Fonte oficial dos Correios</li>
                        <li>‚úÖ Dados sempre corretos</li>
                        <li>‚úÖ Valida√ß√£o de cidade</li>
                        <li>‚úÖ Informa√ß√µes completas</li>
                    </ul>
                </div>
                <div>
                    <h5>üéØ Geocoding (Precis√£o)</h5>
                    <ul>
                        <li>‚úÖ Coordenadas exatas da rua</li>
                        <li>‚úÖ Localiza√ß√£o com n√∫mero</li>
                        <li>‚úÖ Mapa preciso</li>
                        <li>‚úÖ GPS exato para navega√ß√£o</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        let dadosViaCEP = {};
        let coordenadasAproximadas = null;
        let coordenadasPrecisas = null;
        let enderecoCompleto = '';

        // Mapeamento de coordenadas aproximadas por bairro
        const coordenadasBairros = {
            'vila ester': [-23.5889, -46.4836],
            's√£o rafael': [-23.5889, -46.4836],
            'sao rafael': [-23.5889, -46.4836],
            's√£o mateus': [-23.6089, -46.4736],
            'sao mateus': [-23.6089, -46.4736],
            'cidade tiradentes': [-23.5969, -46.4031],
            'itaquera': [-23.5394, -46.4563],
            'centro': [-23.5505, -46.6333],
            'jardins': [-23.5629, -46.6544],
            's√£o paulo': [-23.5505, -46.6333]
        };

        // Configurar eventos
        document.addEventListener('DOMContentLoaded', function() {
            configurarFormulario();
        });

        // Configurar formul√°rio
        function configurarFormulario() {
            const cepInput = document.getElementById('cep');
            const numeroInput = document.getElementById('numero');
            
            // M√°scara do CEP
            cepInput.addEventListener('input', function(e) {
                let value = e.target.value.replace(/\D/g, '');
                if (value.length > 5) {
                    value = value.substring(0, 5) + '-' + value.substring(5, 8);
                }
                e.target.value = value;
                
                if (value.length === 9) {
                    iniciarProcessoHibrido(value);
                }
            });
            
            // Atualizar quando n√∫mero mudar
            numeroInput.addEventListener('input', function() {
                if (dadosViaCEP.cep && this.value.trim()) {
                    geocodificarEndereco();
                }
            });
            
            // Submit do formul√°rio
            document.getElementById('hybridForm').addEventListener('submit', function(e) {
                e.preventDefault();
                criarReclamacao();
            });
        }

        // Iniciar processo h√≠brido
        async function iniciarProcessoHibrido(cep) {
            console.log('üöÄ Iniciando processo h√≠brido para CEP:', cep);
            
            // Mostrar barra de progresso
            mostrarProgresso(0, 'Iniciando processo...');
            
            // Limpar etapas anteriores
            document.querySelectorAll('.step-box').forEach(el => {
                el.classList.remove('active', 'success', 'error');
            });
            
            // Etapa 1: ViaCEP
            await consultarViaCEP(cep);
            
            // Etapa 2: Geocoding (se tiver n√∫mero)
            const numero = document.getElementById('numero').value.trim();
            if (numero) {
                await geocodificarEndereco();
            }
        }

        // Mostrar progresso
        function mostrarProgresso(porcentagem, texto) {
            const progressBar = document.getElementById('progressBar');
            const progressFill = document.getElementById('progressFill');
            
            progressBar.style.display = 'block';
            progressFill.style.width = porcentagem + '%';
            progressFill.textContent = texto;
            
            if (porcentagem >= 100) {
                setTimeout(() => {
                    progressBar.style.display = 'none';
                }, 2000);
            }
        }

        // Consultar ViaCEP
        async function consultarViaCEP(cep) {
            const step1 = document.getElementById('step1');
            const step2 = document.getElementById('step2');
            
            step1.classList.add('active');
            mostrarProgresso(25, 'Consultando ViaCEP...');
            
            try {
                const cepLimpo = cep.replace(/\D/g, '');
                const response = await fetch(`https://viacep.com.br/ws/${cepLimpo}/json/`);
                const data = await response.json();
                
                if (data.erro) {
                    throw new Error('CEP n√£o encontrado');
                }
                
                dadosViaCEP = data;
                
                // Preencher formul√°rio
                document.getElementById('logradouro').value = data.logradouro || '';
                document.getElementById('bairro').value = data.bairro || '';
                document.getElementById('localidade').value = data.localidade || '';
                
                // Determinar coordenadas aproximadas
                const bairro = data.bairro.toLowerCase();
                coordenadasAproximadas = coordenadasBairros[bairro] || coordenadasBairros['s√£o paulo'];
                
                // Mostrar resultado ViaCEP
                step1.classList.remove('active');
                step1.classList.add('success');
                step2.classList.add('active', 'success');
                
                document.getElementById('dadosViaCEP').innerHTML = `
                    <p><strong>‚úÖ CEP:</strong> ${data.cep}</p>
                    <p><strong>‚úÖ Logradouro:</strong> ${data.logradouro || 'N√£o especificado'}</p>
                    <p><strong>‚úÖ Bairro:</strong> ${data.bairro || 'N√£o especificado'}</p>
                    <p><strong>‚úÖ Cidade:</strong> ${data.localidade}</p>
                    <p><strong>‚úÖ UF:</strong> ${data.uf}</p>
                `;
                
                mostrarProgresso(50, 'ViaCEP conclu√≠do');
                
                console.log('‚úÖ ViaCEP conclu√≠do:', data);
                
            } catch (error) {
                console.error('‚ùå Erro no ViaCEP:', error);
                step1.classList.remove('active');
                step1.classList.add('error');
                alert('Erro ao consultar CEP: ' + error.message);
            }
        }

        // Geocodificar endere√ßo
        async function geocodificarEndereco() {
            if (!dadosViaCEP.cep) return;
            
            const numero = document.getElementById('numero').value.trim();
            if (!numero) return;
            
            const step3 = document.getElementById('step3');
            const step4 = document.getElementById('step4');
            
            step3.classList.add('active');
            mostrarProgresso(75, 'Geocodificando endere√ßo...');
            
            try {
                // Montar endere√ßo completo
                enderecoCompleto = `${dadosViaCEP.logradouro}, ${numero}, ${dadosViaCEP.bairro}, ${dadosViaCEP.localidade}, ${dadosViaCEP.uf}, Brasil`;
                
                console.log('üó∫Ô∏è Geocodificando:', enderecoCompleto);
                
                // Tentar m√∫ltiplas APIs de geocodifica√ß√£o
                const apis = [
                    `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(enderecoCompleto)}&limit=1&countrycodes=br`,
                    `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(dadosViaCEP.logradouro + ', ' + dadosViaCEP.bairro + ', S√£o Paulo, SP')}&limit=1&countrycodes=br`
                ];
                
                let geocodingSuccess = false;
                
                for (const api of apis) {
                    try {
                        const response = await fetch(api);
                        const data = await response.json();
                        
                        if (data.length > 0) {
                            coordenadasPrecisas = [parseFloat(data[0].lat), parseFloat(data[0].lon)];
                            geocodingSuccess = true;
                            console.log('‚úÖ Geocoding bem-sucedido:', coordenadasPrecisas);
                            break;
                        }
                    } catch (e) {
                        console.log('API falhou:', api);
                    }
                }
                
                // Se geocoding falhou, usar coordenadas aproximadas
                if (!geocodingSuccess) {
                    coordenadasPrecisas = coordenadasAproximadas;
                    console.log('‚ö†Ô∏è Usando coordenadas aproximadas:', coordenadasPrecisas);
                }
                
                // Mostrar resultado
                step3.classList.remove('active');
                step3.classList.add('success');
                step4.classList.add('active', 'success');
                
                document.getElementById('resultadoGeocoding').innerHTML = `
                    <p><strong>üéØ Endere√ßo completo:</strong> ${enderecoCompleto}</p>
                    <p><strong>üéØ Coordenadas:</strong> ${coordenadasPrecisas[0].toFixed(6)}, ${coordenadasPrecisas[1].toFixed(6)}</p>
                    <p><strong>üéØ Precis√£o:</strong> ${geocodingSuccess ? 'Endere√ßo exato' : 'Regi√£o aproximada'}</p>
                `;
                
                // Mostrar compara√ß√£o
                mostrarComparacao();
                
                // Mostrar mapa
                mostrarMapa();
                
                mostrarProgresso(100, 'Processo conclu√≠do!');
                
            } catch (error) {
                console.error('‚ùå Erro no geocoding:', error);
                step3.classList.remove('active');
                step3.classList.add('error');
                
                // Usar coordenadas aproximadas como fallback
                coordenadasPrecisas = coordenadasAproximadas;
                mostrarMapa();
            }
        }

        // Mostrar compara√ß√£o
        function mostrarComparacao() {
            if (!coordenadasAproximadas || !coordenadasPrecisas) return;
            
            const comparison = document.getElementById('coordComparison');
            const aproximadas = document.getElementById('coordAproximadas');
            const precisas = document.getElementById('coordPrecisas');
            
            aproximadas.innerHTML = `
                <strong>Lat:</strong> ${coordenadasAproximadas[0].toFixed(6)}<br>
                <strong>Lng:</strong> ${coordenadasAproximadas[1].toFixed(6)}
            `;
            
            precisas.innerHTML = `
                <strong>Lat:</strong> ${coordenadasPrecisas[0].toFixed(6)}<br>
                <strong>Lng:</strong> ${coordenadasPrecisas[1].toFixed(6)}
            `;
            
            comparison.style.display = 'block';
        }

        // Mostrar mapa
        function mostrarMapa() {
            if (!coordenadasPrecisas) return;
            
            const mapaEmbed = document.getElementById('mapaEmbed');
            const query = encodeURIComponent(enderecoCompleto || `${coordenadasPrecisas[0]},${coordenadasPrecisas[1]}`);
            
            // Usar Google Maps Embed (funciona sem API key para endere√ßos)
            mapaEmbed.src = `https://www.google.com/maps/embed/v1/place?key=AIzaSyBFw0Qbyq9zTFTd-tUY6dOWTgHz-EGM7Sg&q=${query}`;
            mapaEmbed.style.display = 'block';
        }

        // Testar CEP
        function testarCEP(cep) {
            document.getElementById('cep').value = cep;
            iniciarProcessoHibrido(cep);
        }

        // Abrir Google Maps
        function abrirGoogleMaps() {
            if (!coordenadasPrecisas) {
                alert('Primeiro complete o processo de localiza√ß√£o!');
                return;
            }
            
            const url = `https://www.google.com/maps?q=${coordenadasPrecisas[0]},${coordenadasPrecisas[1]}`;
            window.open(url, '_blank');
        }

        // Copiar coordenadas
        function copiarCoordenadas() {
            if (!coordenadasPrecisas) return;
            
            const texto = `${coordenadasPrecisas[0]}, ${coordenadasPrecisas[1]}`;
            navigator.clipboard.writeText(texto).then(() => {
                alert('Coordenadas precisas copiadas: ' + texto);
            });
        }

        // Copiar endere√ßo
        function copiarEndereco() {
            if (!enderecoCompleto) return;
            
            navigator.clipboard.writeText(enderecoCompleto).then(() => {
                alert('Endere√ßo completo copiado: ' + enderecoCompleto);
            });
        }

        // Criar reclama√ß√£o
        function criarReclamacao() {
            if (!dadosViaCEP.cep || !coordenadasPrecisas) {
                alert('Complete o processo de localiza√ß√£o primeiro!');
                return;
            }
            
            const numero = document.getElementById('numero').value.trim();
            const endereco = `${dadosViaCEP.logradouro}, ${numero} - ${dadosViaCEP.bairro}, ${dadosViaCEP.localidade}`;
            
            const reclamacao = {
                id: Date.now().toString(),
                titulo: document.getElementById('titulo').value.trim(),
                categoria: document.getElementById('categoria').value,
                descricao: document.getElementById('descricao').value.trim(),
                localizacao: endereco,
                enderecoCompleto: enderecoCompleto,
                cep: dadosViaCEP.cep,
                logradouro: dadosViaCEP.logradouro,
                numero: numero,
                bairro: dadosViaCEP.bairro,
                cidade: dadosViaCEP.localidade,
                uf: dadosViaCEP.uf,
                coordenadas: coordenadasPrecisas,
                coordenadasAproximadas: coordenadasAproximadas,
                fonteDados: 'ViaCEP + Geocoding',
                dadosViaCEP: dadosViaCEP,
                sistemaUsado: 'hibrido',
                status: 'pendente',
                usuario: 'Usu√°rio H√≠brido',
                usuarioId: 'hibrido',
                dataReclamacao: new Date().toISOString(),
                midia: []
            };
            
            // Validar campos
            if (!reclamacao.titulo || !reclamacao.categoria || !reclamacao.descricao || !reclamacao.numero) {
                alert('Preencha todos os campos obrigat√≥rios!');
                return;
            }
            
            // Salvar
            let reclamacoes = JSON.parse(localStorage.getItem('reclamacoes') || '[]');
            reclamacoes.push(reclamacao);
            localStorage.setItem('reclamacoes', JSON.stringify(reclamacoes));
            
            alert(`‚úÖ Reclama√ß√£o criada com localiza√ß√£o precisa!

üìù T√≠tulo: ${reclamacao.titulo}
üìç Endere√ßo: ${endereco}
üéØ Coordenadas precisas: ${coordenadasPrecisas[0].toFixed(6)}, ${coordenadasPrecisas[1].toFixed(6)}
üèõÔ∏è Fonte: ViaCEP + Geocoding
üó∫Ô∏è Sistema: H√≠brido (dados oficiais + precis√£o)

A reclama√ß√£o foi salva com a m√°xima precis√£o poss√≠vel!
V√° para o site principal para verificar no mapa.`);
            
            limparFormulario();
        }

        // Limpar formul√°rio
        function limparFormulario() {
            document.getElementById('hybridForm').reset();
            document.querySelectorAll('.step-box').forEach(el => {
                el.classList.remove('active', 'success', 'error');
            });
            document.getElementById('coordComparison').style.display = 'none';
            document.getElementById('mapaEmbed').style.display = 'none';
            document.getElementById('progressBar').style.display = 'none';
            
            dadosViaCEP = {};
            coordenadasAproximadas = null;
            coordenadasPrecisas = null;
            enderecoCompleto = '';
        }
    </script>
</body>
</html>
